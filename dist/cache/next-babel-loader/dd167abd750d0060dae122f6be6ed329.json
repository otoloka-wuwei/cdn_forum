{"ast":null,"code":"var _jsxFileName = \"D:\\\\otoProject\\\\workspace\\\\otoloka-mobile-forum\\\\components\\\\threads-item\\\\index.tsx\";\nvar __jsx = React.createElement;\nimport React, { useContext, useState, useRef, useEffect } from 'react';\nimport './index.scss';\nimport UserAvatar from '../user-avatar';\nimport Like from '../../static/images/like.svg';\nimport Liked from '../../static/images/liked.svg';\nimport ThreadsItemImageList from '../threads-item-image-list';\nimport { useObserver, MobXProviderContext } from 'mobx-react';\nimport DetailService from '../../services/detail';\nimport useMessageBox from '../../hooks/messageBoxHooks';\nimport { useRouter } from 'next/router';\n\nconst ThreadsItem = ({\n  data,\n  onRemove\n}) => {\n  const isLikeSubmit = useRef(false);\n  const {\n    0: supportNums,\n    1: setSupportNums\n  } = useState('0');\n  const {\n    0: shareNums,\n    1: setShareNums\n  } = useState('0');\n  const {\n    0: supportFlag,\n    1: setSupportFlag\n  } = useState(0);\n  const {\n    store\n  } = useContext(MobXProviderContext);\n  const {\n    user\n  } = useObserver(() => ({\n    user: store.user\n  }));\n  const service = new DetailService();\n  const showMessageBox = useMessageBox();\n  const router = useRouter();\n  const {\n    0: isApp,\n    1: setIsApp\n  } = useState(true);\n  useEffect(() => {\n    const isApp = !!window.ReactNativeWebView;\n    setIsApp(isApp);\n\n    if (data) {\n      setSupportNums(data.supportNums);\n      setShareNums(data.shareNums);\n      setSupportFlag(data.supportFlag);\n    }\n  }, []);\n\n  const handelLikeIt = event => {\n    event.stopPropagation();\n\n    if (!user || user.userId <= 0 || !localStorage.getItem('token')) {\n      store.showLoginModal();\n    } else {\n      if (isLikeSubmit.current === false) {\n        isLikeSubmit.current = true;\n        service.updateArticleLike(data.articleId).then(resp => {\n          isLikeSubmit.current = false;\n\n          if (supportFlag === 1) {\n            setSupportFlag(0);\n            countSupportNum(-1);\n          } else {\n            setSupportFlag(1);\n            countSupportNum(1);\n          }\n        }).catch(error => {\n          console.error(error);\n          showMessageBox('error', 'error', 'Like gagal!');\n        });\n      }\n    }\n  };\n\n  const handelComment = () => {\n    if (isApp) {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        action: 'gotoThreadsDetail',\n        data: {\n          threadsId: data.articleId,\n          scrollToComment: true\n        }\n      }));\n    } else {\n      router.push(`/forum/threads/p/${data.articleId}?scrollToComment=true`);\n    }\n  };\n\n  const handelShareIt = event => {\n    event.stopPropagation();\n\n    if (isApp) {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        action: 'share',\n        data: {\n          articleId: data.articleId\n        }\n      }));\n      service.updateArticleShareNums(data.articleId).then(resp => {\n        console.log('分享成功');\n      }).catch(error => {\n        console.error(error);\n        showMessageBox('error', 'error', 'Gagal dibagikan!');\n      });\n    }\n\n    countShareNum(1);\n  };\n\n  const countSupportNum = plus => {\n    if (supportNums !== '999+') {\n      let num = Number(supportNums) + plus;\n\n      if (num > 999) {\n        num = '999+';\n      }\n\n      setSupportNums(num);\n    }\n  };\n\n  const countShareNum = plus => {\n    if (shareNums !== '999+') {\n      let num = Number(shareNums) + plus;\n\n      if (num > 999) {\n        num = '999+';\n      }\n\n      setShareNums(num);\n    }\n  };\n\n  const handleClickRemoveButton = event => {\n    event.stopPropagation();\n\n    if (typeof onRemove === 'function') {\n      onRemove(data);\n    }\n  };\n\n  return data ? __jsx(\"div\", {\n    className: \"threads-item-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: `threads-item-component`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"threads-item-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"message-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"message-avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, __jsx(UserAvatar, {\n    size: 0.36,\n    src: data.userHeadUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    className: \"message-user\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: \"message-user-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 15\n    }\n  }, data.userName), __jsx(\"div\", {\n    className: \"message-release-time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  }, data.timespanText)), user && user.userId === data.userId ? __jsx(\"div\", {\n    className: \"delate-btn\",\n    onClick: handleClickRemoveButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    className: \"icon-font uniE902\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 17\n    }\n  })) : null), __jsx(\"div\", {\n    className: \"body-parent\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: `message-body-child ${data.status === -1 ? 'failed' : ''}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: \"message-body-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: \"message-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 17\n    }\n  }, data.content)), data.urls ? __jsx(\"div\", {\n    className: \"message-image\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 17\n    }\n  }, __jsx(ThreadsItemImageList, {\n    data: data,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 19\n    }\n  })) : null)), data.status === -1 || data.status === -2 ? __jsx(\"div\", {\n    className: \"publish-failed\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 13\n    }\n  }, data.status === -2 ? __jsx(\"i\", {\n    className: \"failed-container loading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 17\n    }\n  }, __jsx(\"i\", {\n    className: \"icon-font uniE90A\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 19\n    }\n  })) : null, data.status === -1 ? __jsx(React.Fragment, null, __jsx(\"i\", {\n    className: \"failed-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 19\n    }\n  }, __jsx(\"i\", {\n    className: \"icon-font uniE90A\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: \"failed-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 19\n    }\n  }, \"Postingan gagal Klik untuk memposting kembali\")) : null) : null), __jsx(\"ul\", {\n    className: \"message-interaction-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 9\n    }\n  }, __jsx(\"li\", {\n    className: \"message-interaction-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"interaction-icon\",\n    onClick: handelLikeIt,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }\n  }, supportFlag === 1 ? __jsx(\"img\", {\n    src: Liked,\n    alt: \"like\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 17\n    }\n  }) : __jsx(\"img\", {\n    src: Like,\n    alt: \"like\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 17\n    }\n  })), __jsx(\"span\", {\n    className: \"interaction-count\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }\n  }, supportNums)), __jsx(\"li\", {\n    className: \"message-interaction-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"interaction-icon \",\n    onClick: handelComment,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, __jsx(\"span\", {\n    className: \"icon-font uniE901\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  })), __jsx(\"span\", {\n    className: \"interaction-count\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  }, data.messageNums)), __jsx(\"li\", {\n    className: \"message-interaction-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"interaction-icon\",\n    onClick: handelShareIt,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }\n  }, __jsx(\"span\", {\n    className: \"icon-font uniE900\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 15\n    }\n  })), __jsx(\"span\", {\n    className: \"interaction-count\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 13\n    }\n  }, shareNums))), __jsx(\"div\", {\n    className: \"threads-item-underline\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 9\n    }\n  }))) : __jsx(\"div\", {\n    className: \"threads-item-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"threads-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"threads-avatar-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  }, \" \"), __jsx(\"div\", {\n    className: \"threads-user-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }\n  }, \" \")), __jsx(\"div\", {\n    className: \"threads-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"body-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"body-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"body-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"body-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"threads-interaction\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"interaction-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"interaction-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"interaction-placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default ThreadsItem;","map":null,"metadata":{},"sourceType":"module"}